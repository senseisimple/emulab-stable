Index: include/headers.h
===================================================================
RCS file: /usr/flux/CVS/emulab-iperf/include/headers.h,v
retrieving revision 1.1.1.1
diff -c -r1.1.1.1 headers.h
*** include/headers.h	24 Oct 2005 15:18:33 -0000	1.1.1.1
--- include/headers.h	24 Oct 2005 16:06:09 -0000
***************
*** 180,186 ****
--- 180,190 ----
  // from the gnu archive
  
  #include <iperf-int.h>
+ #ifdef __FreeBSD__
+ typedef uint64_t max_size_t;
+ #else
  typedef uintmax_t max_size_t;
+ #endif
  
  /* in case the OS doesn't have these, we provide our own implementations */
  #include "gettimeofday.h"
Index: src/Client.cpp
diff -c src/Client.cpp:1.1 src/Client.cpp:1.3
*** src/Client.cpp:1.1	Mon Oct 24 09:18:33 2005
--- src/Client.cpp	Tue Nov  8 17:10:42 2005
***************
*** 216,228 ****
          // perform write 
          currLen = write( mSettings->mSock, mBuf, mSettings->mBufLen ); 
          if ( currLen < 0 ) {
!             WARN_errno( currLen < 0, "write2" ); 
!             break; 
          }
  
!         // report packets 
!         reportstruct->packetLen = currLen;
!         ReportPacket( mSettings->reporthdr, reportstruct );
          
          if ( delay > 0 ) {
              delay_loop( delay ); 
--- 216,231 ----
          // perform write 
          currLen = write( mSettings->mSock, mBuf, mSettings->mBufLen ); 
          if ( currLen < 0 ) {
! 	    if (errno != ENOBUFS) {
!                 WARN_errno( currLen < 0, "write2" ); 
! 		break;
! 	    }
! 	    currLen = 0;
          }
  
! 	// report packets 
! 	reportstruct->packetLen = currLen;
! 	ReportPacket( mSettings->reporthdr, reportstruct );
          
          if ( delay > 0 ) {
              delay_loop( delay ); 
Index: src/main.cpp
===================================================================
RCS file: /usr/flux/CVS/emulab-iperf/src/main.cpp,v
retrieving revision 1.1.1.1
diff -c -r1.1.1.1 main.cpp
*** src/main.cpp	24 Oct 2005 15:18:34 -0000	1.1.1.1
--- src/main.cpp	24 Oct 2005 16:06:10 -0000
***************
*** 163,168 ****
--- 163,173 ----
      // read settings from command-line parameters
      Settings_ParseCommandLine( argc, argv, ext_gSettings );
  
+     // if needed, redirect the output into a specified file
+     if ( !isSTDOUT( ext_gSettings ) ) {
+         redirect( ext_gSettings->mOutputFileName );
+     }
+ 
      // Check for either having specified client or server
      if ( ext_gSettings->mThreadMode == kMode_Client 
           || ext_gSettings->mThreadMode == kMode_Listener ) {
Index: src/stdio.c
===================================================================
RCS file: /usr/flux/CVS/emulab-iperf/src/stdio.c,v
retrieving revision 1.1.1.1
diff -c -r1.1.1.1 stdio.c
*** src/stdio.c	24 Oct 2005 15:18:34 -0000	1.1.1.1
--- src/stdio.c	24 Oct 2005 16:06:10 -0000
***************
*** 255,262 ****
   * ------------------------------------------------------------------- */
  
  void redirect(const char *inOutputFileName) {
- #ifdef WIN32
- 
      FILE *fp;
  
      if ( inOutputFileName == NULL ) {
--- 255,260 ----
***************
*** 264,277 ****
          return;
      }
  
!     fp = freopen(inOutputFileName, "a+", stdout);
      if ( fp == NULL ) {
          fprintf(stderr, "redirect stdout failed!\n");
          return;
      }
- 
- #endif
- 
      return;
  }
  
--- 262,272 ----
          return;
      }
  
!     fp = freopen(inOutputFileName, "a", stdout);
      if ( fp == NULL ) {
          fprintf(stderr, "redirect stdout failed!\n");
          return;
      }
      return;
  }
  
